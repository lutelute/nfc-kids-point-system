# 改良版iPhoneショートカット設定ガイド 📱

インタラクティブなポイント選択機能を含む、改良版ショートカットの詳細設定手順です。

## 🎯 新機能の特徴

- ✅ ポイント数をその場で選択可能
- ✅ 視覚的・音響的フィードバック
- ✅ より使いやすいユーザーインターフェース
- ✅ 柔軟なポイント制度対応

---

## 📋 ショートカット構成

### 全体のフロー
```
NFC読み取り → メニュー選択 → ポイント選択 → データ送信 → フィードバック
```

---

## 🚀 ステップバイステップ設定

### Step 1: 新規ショートカット作成

1. **ショートカットアプリ**を開く
2. 右上の**「+」**をタップ
3. **「アクションを追加」**をタップ

### Step 2: メニュー選択の追加

**アクション**: メニューから選択
```
プロンプト: ポイントをたくさん取りますか？
選択肢:
- はい
- いいえ
```

**設定手順:**
1. 「メニューから選択」アクションを追加
2. プロンプト欄に質問文を入力
3. 選択肢を「はい」「いいえ」で設定

### Step 3: 条件分岐の設定

**アクション**: If文

**「はい」を選択した場合:**
```
アクション: リストから選択
プロンプト: ポイント数を選択してください
選択肢: 1, 2, 3, 5, 10
変数名: selectedPoints
```

**「いいえ」を選択した場合:**
```
アクション: テキスト
内容: 1
変数名: selectedPoints
```

### Step 4: 辞書の作成

**アクション**: 辞書
```
キー: nfcId    値: nfc-taro-001
キー: tagName  値: 太郎
キー: points   値: [変数:selectedPoints]
```

**設定手順:**
1. 「辞書」アクションを追加
2. 各キーと値を設定
3. points の値は変数「selectedPoints」を選択

### Step 5: Webリクエスト送信

**アクション**: Webの内容を取得
```
URL: [Google Apps ScriptのWebアプリURL]
メソッド: POST
ヘッダ: 
  Content-Type: application/json
本文: [前のステップで作成した辞書]
```

### Step 6: フィードバック追加

**アクション1**: デバイスを振動
```
振動パターン: 通知
```

**アクション2**: サウンドを再生
```
サウンド: 完了音
```

**アクション3** (オプション): 通知を表示
```
タイトル: ポイント記録完了！
本文: [変数:tagName] の [変数:selectedPoints] ポイントが記録されました
```

---

## ⚙️ 各子供用の設定例

### 太郎くん用
```
辞書設定:
- nfcId: "nfc-taro-001"
- tagName: "太郎"
- points: [選択されたポイント]
```

### 花子ちゃん用
```
辞書設定:
- nfcId: "nfc-hanako-001" 
- tagName: "花子"
- points: [選択されたポイント]
```

### 次郎くん用
```
辞書設定:
- nfcId: "nfc-jiro-001"
- tagName: "次郎"
- points: [選択されたポイント]
```

---

## 🔧 高度なカスタマイズ

### A. 活動別ポイント設定

**初期メニューを活動別に変更:**
```
プロンプト: どの活動を完了しましたか？
選択肢:
- 宿題 (5ポイント)
- お手伝い (3ポイント)
- 基本活動 (1ポイント)
```

### B. 時間制限の追加

**平日のみポイント付与:**
```
アクション: 現在の日付を取得
アクション: If文で曜日をチェック
条件: 月曜日〜金曜日の場合のみ処理続行
```

### C. 連続記録ボーナス

**連続記録日数に応じてボーナス:**
```
アクション: Webリクエストのレスポンスを取得
アクション: 連続日数をチェック
アクション: ボーナスポイントを追加
```

---

## 🧪 動作テスト

### テスト1: 手動実行
1. ショートカット一覧から作成したショートカットをタップ
2. メニュー選択が正しく表示されることを確認
3. ポイント選択が正常に動作することを確認
4. フィードバック（振動・音）が正しく再生されることを確認

### テスト2: NFCトリガー
1. NFCタグを設定
2. タグをスキャンして自動実行されることを確認
3. 「実行前に確認」がOFFになっていることを確認

### テスト3: データ送信確認
1. Google スプレッドシートにアクセス
2. 選択したポイント数が正しく記録されていることを確認
3. タイムスタンプとユーザー名が正しいことを確認

---

## 🚨 トラブルシューティング

### 問題1: 変数が正しく渡されない
**解決策:**
- 変数名のスペルミスがないか確認
- If文の分岐が正しく設定されているか確認
- 変数のスコープ（有効範囲）を確認

### 問題2: 辞書の作成でエラー
**解決策:**
- キーと値の組み合わせが正しいか確認
- 変数が正しく参照されているか確認
- JSON形式として有効な内容になっているか確認

### 問題3: Webリクエストが失敗
**解決策:**
- Apps Script WebアプリのURLが正しいか確認
- ヘッダーの設定が正しいか確認
- ネットワーク接続を確認

---

## 📊 効果的な運用例

### パターン1: 基本的な使い方
```
日常的な活動: 「いいえ」→ 1ポイント自動付与
特別な頑張り: 「はい」→ ポイント数を選択
```

### パターン2: 活動別設定
```
宿題完了: 5ポイント固定
お手伝い: 3ポイント固定  
基本活動: 1-2ポイント選択
特別成果: 5-10ポイント選択
```

### パターン3: 時間帯別設定
```
朝の活動（7-9時）: 基本ポイント
放課後（15-18時）: 学習ポイント
夜の活動（18-21時）: お手伝いポイント
```

---

## 🎉 完成チェックリスト

- [ ] メニュー選択が正常に動作する
- [ ] ポイント選択が正しく反映される
- [ ] 辞書作成でエラーが発生しない
- [ ] Webリクエストが成功する
- [ ] 振動とサウンドフィードバックが動作する
- [ ] NFCトリガーで自動実行される
- [ ] スプレッドシートにデータが正しく記録される

---

## 📞 さらなるサポート

詳細な設定方法や追加機能については：
- [基本セットアップガイド](setup-guide.md)
- [詳細セットアップガイド](detailed-setup-with-screenshots.md)
- [システム構成図](system-architecture.md)

**設定のコツ**: 最初は シンプルな設定から始めて、慣れてきたら高度な機能を追加していくことをお勧めします！