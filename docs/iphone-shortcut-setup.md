# iPhone ショートカット設定ガイド 📱

このドキュメントでは、NFCキッズポイントシステムで使用するiPhoneショートカットの設定方法を説明します。

## 📋 前提条件

- iPhone（iOS 13以降、NFC対応機種）
- ショートカットアプリ（プリインストール）
- NFCタグ（NTAG213、NTAG215、NTAG216推奨）

## 🚀 ショートカット作成手順

### 1. ショートカットアプリを開く

iPhoneのホーム画面から「ショートカット」アプリをタップして開きます。

### 2. 新規ショートカットを作成

1. 右上の「+」ボタンをタップ
2. 「アクションを追加」をタップ

### 3. Webリクエストアクションを追加

1. 検索バーで「Web」と入力
2. 「Webの内容を取得」を選択

### 4. リクエスト設定

以下のように設定します：

```
URL: [Google Apps ScriptのWebアプリURL]
メソッド: POST
ヘッダ:
  Content-Type: application/json
本文: JSON形式
```

#### JSON本文の設定例：
```json
{
  "nfcId": "unique-nfc-id",
  "tagName": "[子供の名前]",
  "points": 1
}
```

### 5. NFCトリガーを設定

1. ショートカット画面の上部「設定」をタップ
2. 「オートメーションに追加」をタップ
3. 「NFC」を選択
4. NFCタグをスキャンしてペアリング

## 📖 詳細設定

### ショートカットの構成

#### アクション1: 変数設定
```
アクション: テキスト
内容: [子供の名前]
変数名: UserName
```

#### アクション2: JSONデータ作成
```
アクション: テキスト
内容: 
{
  "nfcId": "[NFCタグの固有ID]",
  "tagName": "[変数:UserName]",
  "points": 1
}
変数名: JSONData
```

#### アクション3: Webリクエスト
```
アクション: Webの内容を取得
URL: [Google Apps ScriptのURL]
メソッド: POST
ヘッダ:
  Content-Type: application/json
本文: [変数:JSONData]
```

#### アクション4: 結果表示（オプション）
```
アクション: 通知を表示
タイトル: "ポイント記録完了！"
本文: "[変数:UserName]のポイントが記録されました"
```

## 🏷️ NFCタグの設定

### 推奨NFCタグ仕様
- **容量**: 180byte以上（NTAG213推奨）
- **周波数**: 13.56MHz
- **規格**: ISO14443 Type A

### 各子供用の個別設定

1. **太郎くん用**
   ```json
   {
     "nfcId": "nfc-taro-001",
     "tagName": "太郎",
     "points": 1
   }
   ```

2. **花子ちゃん用**
   ```json
   {
     "nfcId": "nfc-hanako-001", 
     "tagName": "花子",
     "points": 1
   }
   ```

## 📱 使用方法

### 基本的な使い方
1. NFCタグを子供に渡す
2. 親がiPhoneでNFCタグをスキャン
3. 自動的にショートカットが実行
4. ポイントがシステムに記録
5. ダッシュボードで確認

### ポイント記録のタイミング例
- ✅ 宿題完了時
- ✅ お手伝い完了時
- ✅ 良い行いをした時
- ✅ 目標達成時

## 🔧 トラブルシューティング

### NFCが読み取れない場合

**症状**: NFCタグをスキャンしても反応しない

**対処法**:
1. iPhoneの設定 > プライバシーとセキュリティ > NFC が有効か確認
2. NFCタグをiPhone上部（カメラ付近）に近づける
3. ケースが厚い場合は外して試す
4. 金属製のケースの場合は干渉の可能性

### ショートカットが実行されない場合

**症状**: NFCスキャンしてもショートカットが動作しない

**対処法**:
1. ショートカットアプリでオートメーションの設定を確認
2. 「実行前に尋ねる」をオフに設定
3. ショートカットの権限設定を確認
4. 手動でショートカットを実行してテスト

### データが記録されない場合

**症状**: ショートカットは実行されるがデータがダッシュボードに表示されない

**対処法**:
1. Google Apps ScriptのURLが正しいか確認
2. Webアプリの公開設定を確認（「アクセスできるユーザー: 全員」）
3. JSONフォーマットが正しいか確認
4. ネットワーク接続を確認

### エラーメッセージが表示される場合

**403エラー**:
- Apps Scriptの権限設定を確認
- Webアプリの公開設定を見直し

**500エラー**:
- スプレッドシートのアクセス権限を確認
- スクリプトのエラーログを確認

**ネットワークエラー**:
- インターネット接続を確認
- Wi-Fi/モバイルデータの切り替えを試す

## 🎯 使用例とベストプラクティス

### 家庭での活用例

#### 朝のルーティン
```
- 歯磨き完了 → NFCスキャン → +1ポイント
- 着替え完了 → NFCスキャン → +1ポイント  
- 朝食完食 → NFCスキャン → +2ポイント
```

#### 宿題・勉強
```
- 宿題30分 → NFCスキャン → +3ポイント
- 読書15分 → NFCスキャン → +2ポイント
- テスト良い点 → NFCスキャン → +5ポイント
```

#### お手伝い
```
- 食器洗い → NFCスキャン → +2ポイント
- 掃除機かけ → NFCスキャン → +3ポイント
- 洗濯物畳み → NFCスキャン → +2ポイント
```

### ポイント配分の提案

| 活動 | 推奨ポイント | 理由 |
|------|-------------|------|
| 基本的な習慣 | 1-2pt | 毎日継続してもらいたい活動 |
| 勉強・宿題 | 3-5pt | 重要で時間のかかる活動 |
| お手伝い | 2-4pt | 家族貢献の価値を示す |
| 特別な成果 | 5-10pt | 特別な努力や成果の報酬 |

### セキュリティ考慮事項

1. **NFCタグの管理**
   - 子供が勝手にスキャンできないよう管理
   - 定期的にタグの動作確認

2. **データの確認**
   - 定期的にダッシュボードで記録確認
   - 異常なポイント増加がないかチェック

3. **プライバシー**
   - 家族内でのデータ共有ルールを設定
   - 子供のプライバシーに配慮した記録

## 📊 応用設定

### 複数ポイント設定

異なる活動に異なるポイントを設定する場合：

```json
{
  "nfcId": "nfc-taro-homework",
  "tagName": "太郎", 
  "points": 5,
  "activity": "宿題"
}
```

### 時間帯制限

特定の時間帯のみポイント付与する場合のショートカット例：

```
1. 現在時刻を取得
2. 時刻を判定（条件分岐）
3. 条件に合致する場合のみWebリクエスト実行
```

## 🤝 サポート

設定でお困りの場合は、以下をお試しください：

1. [トラブルシューティング](#-トラブルシューティング)セクションを確認
2. ショートカットアプリの公式ヘルプを参照
3. NFCタグの取扱説明書を確認
4. システムの[セットアップガイド](setup-guide.md)を再確認

---

**次のステップ**: [システム構成](system-architecture.md)を確認して全体的な仕組みを理解しましょう。